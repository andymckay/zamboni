[monolith]
timeout = 10
batch_size = 100
sequence = extract, load
database = mysql+pymysql://root@mysql/monolith

[phase:extract]
sources = mkt-new-user
targets = sql

[phase:load]
sources = sql
targets = es

[source:mkt-new-user]
id = mkt-new-user
use = monolith.aggregator.plugins.zamboni.APIReader
type = new-user
field = user_count
endpoint = http://mp.dev/api/monolith/data/
password-file = %(here)s/docker-password.ini

[target:sql]
id = sql
use = monolith.aggregator.db.Database
database = mysql+pymysql://root@mysql/monolith

[source:sql]
id = sql
use = monolith.aggregator.db.Database
database = mysql+pymysql://root@mysql/monolith
query = SELECT id AS _id, type AS _type, date, value FROM record WHERE date BETWEEN :start_date AND :end_date
json_fields = value

[target:es]
id = es
use = monolith.aggregator.plugins.es.ESWrite
url = http://elasticsearch:9200

[target:stdout]
id = stdout
use = monolith.aggregator.plugins.std.Out
